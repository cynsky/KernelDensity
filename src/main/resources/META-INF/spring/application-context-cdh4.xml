<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:hdp="http://www.springframework.org/schema/hadoop"
       xsi:schemaLocation="
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/hadoop http://www.springframework.org/schema/hadoop/spring-hadoop.xsd">

    <!--
    -78.347608170043
    -76.804034067044

    38.128349719377
    39.629185383287
    -->

    <hdp:configuration id="hadoopConfiguration">

        fs.defaultFS=hdfs://ec2-174-129-69-14.compute-1.amazonaws.com:8020

        mapred.job.tracker=ec2-174-129-69-14.compute-1.amazonaws.com:8021

        hadoop.job.ugi=mraad_admin,mraad_admin
        hadoop.socks.server=localhost:6666
        hadoop.rpc.socket.factory.class.default=org.apache.hadoop.net.SocksSocketFactory

        com.esri.xmin=-78.347608170043
        com.esri.xmax=-76.804034067044
        com.esri.ymin=38.128349719377
        com.esri.ymax=39.629185383287
        com.esri.cell=60

        com.esri.numFields=14
        com.esri.fieldSep=,
        com.esri.lonField=12
        com.esri.latField=13
        com.esri.sumField=1

    </hdp:configuration>

    <hdp:job id="mr-job"
             jar-by-class="com.esri.density.Main"
             input-path="/user/mraad_admin/evdo"
             output-path="/user/mraad_admin/raster"
             mapper="com.esri.density.CellFilterMapper"
             combiner="com.esri.density.CellReducer"
             reducer="com.esri.density.CellReducer"/>

    <hdp:script id="preAction" language="javascript">
        if (fsh.test("/user/mraad_admin/raster")){
        fsh.rmr("/user/mraad_admin/raster")
        }
    </hdp:script>

    <bean id="postAction" class="com.esri.density.RasterAscii">
        <property name="configuration" ref="hadoopConfiguration"/>
        <property name="hdfsPath" value="/user/mraad_admin/raster"/>
        <property name="filePath" value="/tmp/reverse.asc"/>
    </bean>

    <hdp:job-runner id="runner"
                    run-at-startup="true"
                    pre-action="preAction"
                    post-action="postAction"
                    job-ref="mr-job"/>

</beans>